#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <sys/time.h>

#define NET_SIZE 400
#define SPARSE_BOUND 96

short lut[2048] = {
		0,16,32,48,64,80,96,112,128,144,160,176,192,208,224,240,
		256,272,288,304,320,336,352,368,384,400,416,432,448,464,480,496,
		512,528,544,560,576,592,608,624,640,656,672,688,704,720,736,752,
		768,784,800,816,832,848,864,880,896,912,928,943,959,975,991,1007,
		1023,1039,1055,1071,1087,1103,1119,1135,1151,1167,1183,1199,1215,1231,1247,1263,
		1279,1295,1311,1327,1343,1359,1375,1391,1407,1423,1439,1455,1471,1487,1503,1519,
		1535,1551,1567,1583,1598,1614,1630,1646,1662,1678,1694,1710,1726,1742,1758,1774,
		1790,1806,1822,1838,1854,1870,1886,1902,1918,1934,1949,1965,1981,1997,2013,2029,
		2045,2061,2077,2093,2109,2125,2141,2157,2173,2188,2204,2220,2236,2252,2268,2284,
		2300,2316,2332,2348,2364,2380,2395,2411,2427,2443,2459,2475,2491,2507,2523,2539,
		2555,2570,2586,2602,2618,2634,2650,2666,2682,2698,2714,2729,2745,2761,2777,2793,
		2809,2825,2841,2856,2872,2888,2904,2920,2936,2952,2968,2983,2999,3015,3031,3047,
		3063,3079,3094,3110,3126,3142,3158,3174,3190,3205,3221,3237,3253,3269,3285,3301,
		3316,3332,3348,3364,3380,3396,3411,3427,3443,3459,3475,3490,3506,3522,3538,3554,
		3570,3585,3601,3617,3633,3649,3664,3680,3696,3712,3728,3743,3759,3775,3791,3806,
		3822,3838,3854,3870,3885,3901,3917,3933,3948,3964,3980,3996,4012,4027,4043,4059,
		4075,4090,4106,4122,4138,4153,4169,4185,4201,4216,4232,4248,4263,4279,4295,4311,
		4326,4342,4358,4373,4389,4405,4421,4436,4452,4468,4483,4499,4515,4531,4546,4562,
		4578,4593,4609,4625,4640,4656,4672,4687,4703,4719,4734,4750,4766,4781,4797,4813,
		4828,4844,4860,4875,4891,4907,4922,4938,4953,4969,4985,5000,5016,5032,5047,5063,
		5078,5094,5110,5125,5141,5157,5172,5188,5203,5219,5235,5250,5266,5281,5297,5312,
		5328,5344,5359,5375,5390,5406,5421,5437,5453,5468,5484,5499,5515,5530,5546,5561,
		5577,5592,5608,5624,5639,5655,5670,5686,5701,5717,5732,5748,5763,5779,5794,5810,
		5825,5841,5856,5872,5887,5903,5918,5934,5949,5965,5980,5995,6011,6026,6042,6057,
		6073,6088,6104,6119,6135,6150,6165,6181,6196,6212,6227,6243,6258,6273,6289,6304,
		6320,6335,6350,6366,6381,6397,6412,6427,6443,6458,6473,6489,6504,6520,6535,6550,
		6566,6581,6596,6612,6627,6642,6658,6673,6688,6704,6719,6734,6750,6765,6780,6796,
		6811,6826,6842,6857,6872,6888,6903,6918,6933,6949,6964,6979,6995,7010,7025,7040,
		7056,7071,7086,7101,7117,7132,7147,7162,7178,7193,7208,7223,7238,7254,7269,7284,
		7299,7314,7330,7345,7360,7375,7390,7406,7421,7436,7451,7466,7482,7497,7512,7527,
		7542,7557,7572,7588,7603,7618,7633,7648,7663,7678,7693,7709,7724,7739,7754,7769,
		7784,7799,7814,7829,7845,7860,7875,7890,7905,7920,7935,7950,7965,7980,7995,8010,
		8025,8040,8055,8070,8085,8100,8115,8130,8145,8160,8175,8190,8205,8220,8235,8250,
		8265,8280,8295,8310,8325,8340,8355,8370,8385,8400,8415,8430,8445,8460,8475,8490,
		8505,8520,8534,8549,8564,8579,8594,8609,8624,8639,8654,8669,8683,8698,8713,8728,
		8743,8758,8773,8787,8802,8817,8832,8847,8862,8877,8891,8906,8921,8936,8951,8965,
		8980,8995,9010,9025,9039,9054,9069,9084,9098,9113,9128,9143,9157,9172,9187,9202,
		9216,9231,9246,9261,9275,9290,9305,9320,9334,9349,9364,9378,9393,9408,9422,9437,
		9452,9466,9481,9496,9510,9525,9540,9554,9569,9584,9598,9613,9627,9642,9657,9671,
		9686,9700,9715,9730,9744,9759,9773,9788,9803,9817,9832,9846,9861,9875,9890,9904,
		9919,9933,9948,9963,9977,9992,10006,10021,10035,10050,10064,10079,10093,10108,10122,10136,
		10151,10165,10180,10194,10209,10223,10238,10252,10267,10281,10295,10310,10324,10339,10353,10367,
		10382,10396,10411,10425,10439,10454,10468,10482,10497,10511,10526,10540,10554,10569,10583,10597,
		10612,10626,10640,10654,10669,10683,10697,10712,10726,10740,10755,10769,10783,10797,10812,10826,
		10840,10854,10869,10883,10897,10911,10926,10940,10954,10968,10982,10997,11011,11025,11039,11053,
		11067,11082,11096,11110,11124,11138,11152,11167,11181,11195,11209,11223,11237,11251,11265,11280,
		11294,11308,11322,11336,11350,11364,11378,11392,11406,11420,11434,11448,11463,11477,11491,11505,
		11519,11533,11547,11561,11575,11589,11603,11617,11631,11645,11659,11673,11687,11701,11715,11728,
		11742,11756,11770,11784,11798,11812,11826,11840,11854,11868,11882,11896,11909,11923,11937,11951,
		11965,11979,11993,12006,12020,12034,12048,12062,12076,12090,12103,12117,12131,12145,12159,12172,
		12186,12200,12214,12227,12241,12255,12269,12283,12296,12310,12324,12337,12351,12365,12379,12392,
		12406,12420,12433,12447,12461,12475,12488,12502,12516,12529,12543,12557,12570,12584,12597,12611,
		12625,12638,12652,12666,12679,12693,12706,12720,12734,12747,12761,12774,12788,12801,12815,12829,
		12842,12856,12869,12883,12896,12910,12923,12937,12950,12964,12977,12991,13004,13018,13031,13045,
		13058,13072,13085,13098,13112,13125,13139,13152,13166,13179,13192,13206,13219,13233,13246,13259,
		13273,13286,13299,13313,13326,13340,13353,13366,13380,13393,13406,13420,13433,13446,13459,13473,
		13486,13499,13513,13526,13539,13552,13566,13579,13592,13605,13619,13632,13645,13658,13672,13685,
		13698,13711,13724,13738,13751,13764,13777,13790,13803,13817,13830,13843,13856,13869,13882,13895,
		13909,13922,13935,13948,13961,13974,13987,14000,14013,14026,14039,14053,14066,14079,14092,14105,
		14118,14131,14144,14157,14170,14183,14196,14209,14222,14235,14248,14261,14274,14287,14300,14313,
		14326,14338,14351,14364,14377,14390,14403,14416,14429,14442,14455,14468,14480,14493,14506,14519,
		14532,14545,14558,14570,14583,14596,14609,14622,14635,14647,14660,14673,14686,14699,14711,14724,
		14737,14750,14762,14775,14788,14801,14813,14826,14839,14851,14864,14877,14890,14902,14915,14928,
		14940,14953,14966,14978,14991,15004,15016,15029,15042,15054,15067,15079,15092,15105,15117,15130,
		15142,15155,15168,15180,15193,15205,15218,15230,15243,15255,15268,15280,15293,15306,15318,15331,
		15343,15355,15368,15380,15393,15405,15418,15430,15443,15455,15468,15480,15492,15505,15517,15530,
		15542,15555,15567,15579,15592,15604,15616,15629,15641,15654,15666,15678,15691,15703,15715,15728,
		15740,15752,15764,15777,15789,15801,15814,15826,15838,15850,15863,15875,15887,15899,15912,15924,
		15936,15948,15960,15973,15985,15997,16009,16021,16034,16046,16058,16070,16082,16094,16106,16119,
		16131,16143,16155,16167,16179,16191,16203,16215,16228,16240,16252,16264,16276,16288,16300,16312,
		16324,16336,16348,16360,16372,16384,16396,16408,16420,16432,16444,16456,16468,16480,16492,16504,
		16516,16528,16540,16551,16563,16575,16587,16599,16611,16623,16635,16647,16658,16670,16682,16694,
		16706,16718,16730,16741,16753,16765,16777,16789,16800,16812,16824,16836,16848,16859,16871,16883,
		16895,16906,16918,16930,16942,16953,16965,16977,16988,17000,17012,17023,17035,17047,17058,17070,
		17082,17093,17105,17117,17128,17140,17152,17163,17175,17186,17198,17210,17221,17233,17244,17256,
		17267,17279,17291,17302,17314,17325,17337,17348,17360,17371,17383,17394,17406,17417,17429,17440,
		17452,17463,17474,17486,17497,17509,17520,17532,17543,17554,17566,17577,17589,17600,17611,17623,
		17634,17646,17657,17668,17680,17691,17702,17714,17725,17736,17748,17759,17770,17781,17793,17804,
		17815,17827,17838,17849,17860,17872,17883,17894,17905,17916,17928,17939,17950,17961,17972,17984,
		17995,18006,18017,18028,18039,18051,18062,18073,18084,18095,18106,18117,18129,18140,18151,18162,
		18173,18184,18195,18206,18217,18228,18239,18250,18261,18272,18283,18294,18305,18316,18327,18338,
		18349,18360,18371,18382,18393,18404,18415,18426,18437,18448,18459,18470,18481,18492,18503,18513,
		18524,18535,18546,18557,18568,18579,18590,18600,18611,18622,18633,18644,18655,18665,18676,18687,
		18698,18709,18719,18730,18741,18752,18762,18773,18784,18795,18805,18816,18827,18837,18848,18859,
		18870,18880,18891,18902,18912,18923,18934,18944,18955,18966,18976,18987,18998,19008,19019,19029,
		19040,19051,19061,19072,19082,19093,19103,19114,19125,19135,19146,19156,19167,19177,19188,19198,
		19209,19219,19230,19240,19251,19261,19272,19282,19293,19303,19313,19324,19334,19345,19355,19366,
		19376,19386,19397,19407,19418,19428,19438,19449,19459,19469,19480,19490,19500,19511,19521,19531,
		19542,19552,19562,19573,19583,19593,19603,19614,19624,19634,19645,19655,19665,19675,19685,19696,
		19706,19716,19726,19737,19747,19757,19767,19777,19787,19798,19808,19818,19828,19838,19848,19858,
		19869,19879,19889,19899,19909,19919,19929,19939,19949,19959,19969,19979,19990,20000,20010,20020,
		20030,20040,20050,20060,20070,20080,20090,20100,20110,20120,20130,20140,20149,20159,20169,20179,
		20189,20199,20209,20219,20229,20239,20249,20259,20268,20278,20288,20298,20308,20318,20328,20337,
		20347,20357,20367,20377,20387,20396,20406,20416,20426,20436,20445,20455,20465,20475,20484,20494,
		20504,20514,20523,20533,20543,20552,20562,20572,20582,20591,20601,20611,20620,20630,20640,20649,
		20659,20668,20678,20688,20697,20707,20717,20726,20736,20745,20755,20765,20774,20784,20793,20803,
		20812,20822,20831,20841,20850,20860,20869,20879,20888,20898,20907,20917,20926,20936,20945,20955,
		20964,20974,20983,20993,21002,21011,21021,21030,21040,21049,21058,21068,21077,21087,21096,21105,
		21115,21124,21133,21143,21152,21161,21171,21180,21189,21199,21208,21217,21227,21236,21245,21254,
		21264,21273,21282,21291,21301,21310,21319,21328,21338,21347,21356,21365,21374,21384,21393,21402,
		21411,21420,21429,21439,21448,21457,21466,21475,21484,21493,21503,21512,21521,21530,21539,21548,
		21557,21566,21575,21584,21593,21602,21611,21620,21629,21639,21648,21657,21666,21675,21684,21693,
		21702,21711,21719,21728,21737,21746,21755,21764,21773,21782,21791,21800,21809,21818,21827,21836,
		21845,21853,21862,21871,21880,21889,21898,21907,21915,21924,21933,21942,21951,21960,21968,21977,
		21986,21995,22004,22012,22021,22030,22039,22047,22056,22065,22074,22082,22091,22100,22109,22117,
		22126,22135,22143,22152,22161,22169,22178,22187,22195,22204,22213,22221,22230,22239,22247,22256,
		22265,22273,22282,22290,22299,22308,22316,22325,22333,22342,22350,22359,22368,22376,22385,22393,
		22402,22410,22419,22427,22436,22444,22453,22461,22470,22478,22487,22495,22503,22512,22520,22529,
		22537,22546,22554,22563,22571,22579,22588,22596,22605,22613,22621,22630,22638,22646,22655,22663,
		22671,22680,22688,22696,22705,22713,22721,22730,22738,22746,22755,22763,22771,22779,22788,22796,
		22804,22812,22821,22829,22837,22845,22854,22862,22870,22878,22886,22895,22903,22911,22919,22927,
		22935,22944,22952,22960,22968,22976,22984,22992,23001,23009,23017,23025,23033,23041,23049,23057,
		23065,23073,23081,23090,23098,23106,23114,23122,23130,23138,23146,23154,23162,23170,23178,23186,
		23194,23202,23210,23218,23226,23234,23242,23250,23257,23265,23273,23281,23289,23297,23305,23313,
		23321,23329,23337,23344,23352,23360,23368,23376,23384,23392,23399,23407,23415,23423,23431,23439,
		23446,23454,23462,23470,23478,23485,23493,23501,23509,23516,23524,23532,23540,23547,23555,23563,
		23571,23578,23586,23594,23602,23609,23617,23625,23632,23640,23648,23655,23663,23671,23678,23686,
		23694,23701,23709,23716,23724,23732,23739,23747,23754,23762,23770,23777,23785,23792,23800,23807,
		23815,23823,23830,23838,23845,23853,23860,23868,23875,23883,23890,23898,23905,23913,23920,23928,
		23935,23943,23950,23957,23965,23972,23980,23987,23995,24002,24009,24017,24024,24032,24039,24046,
		24054,24061,24069,24076,24083,24091,24098,24105,24113,24120,24127,24135,24142,24149,24157,24164,
		24171,24178,24186,24193,24200,24208,24215,24222,24229,24237,24244,24251,24258,24266,24273,24280,
		24287,24294,24302,24309,24316,24323,24330,24338,24345,24352,24359,24366,24373,24381,24388,24395,
		24402,24409,24416,24423,24430,24437,24445,24452,24459,24466,24473,24480,24487,24494,24501,24508,
		24515,24522,24529,24536,24543,24550,24557,24564,24571,24578,24585,24592,24599,24606,24613,24620,
		24627,24634,24641,24648,24655,24662,24669,24676,24683,24690,24697,24704,24711,24717,24724,24731,
		24738,24745,24752,24759,24766,24772,24779,24786,24793,24800,24807,24813,24820,24827,24834,24841,
		24848,24854,24861,24868,24875,24881,24888,24895,24902,24909,24915,24922,24929,24935,24942,24949};



int main() {
	
    FILE *ifp, *ofp, *tfp;
    struct timeval t1, t2, tr, tacc1, tacc2;

    int i, j, t;

    short inWM[NET_SIZE];
    short ofbWM[2][NET_SIZE];
    short intWM[NET_SIZE][NET_SIZE];
    short outWM[NET_SIZE+1][2];

    int initialRunlength = 640;
    int plotRunlength = 50000; // 3200*6*6;
    int samplelength = initialRunlength + plotRunlength;
    int offs = 100000;

    short sampleinput[samplelength];
    short sampleout[samplelength][2];
   
    //float inputscaling = 0.125;
    //int inputshift = 0;
    //float teacherscaling[2] = {0.25, 0.25};
    //int teachershift[2] = {0, 0};
 
    short in;
    //float teach[2];

    short totalstate[NET_SIZE+3];
    int internalState[NET_SIZE];
    int netOut[2];

    //float max_tanh_x = 0;
    //float min_tanh_x = 0;

    short internalState_entry;
    short netOut0_entry;
    short netOut1_entry;

    // Read in inWM from "inWM.bin" file
    if (!(ifp = fopen("inWM.bin", "rb"))) {
        printf("File inWM.bin cannot be opened for read.\n");
        return -1;
    }
    fread(inWM, 2, NET_SIZE, ifp);
    fclose(ifp);

    // Read in ofbWM from "ofbWM.bin" file
    if (!(ifp = fopen("ofbWM.bin", "rb"))) {
        printf("File ofbWM.bin cannot be opened for read.\n");
        return -1;
    }
    fread(ofbWM[0], 2, NET_SIZE, ifp);
    fread(ofbWM[1], 2, NET_SIZE, ifp);
    fclose(ifp);

    // Read in intWM from "intWM.bin" file
    if (!(ifp = fopen("intWM.bin", "rb"))) {
        printf("File intWM.bin cannot be opened for read.\n");
        return -1;
    }
    for (i = 0; i < NET_SIZE; ++i)
        fread(intWM[i], 2, NET_SIZE, ifp);
    fclose(ifp);

    // Read in outWM from "outWM.bin" file
    if (!(ifp = fopen("outWM.bin", "rb"))) {
        printf("File outWM.bin cannot be opened for read.\n");
        return -1;
    }
    for (i = 0; i < NET_SIZE+1; ++i)
        fread(outWM[i], 2, 2, ifp);
    fclose(ifp);

    // Read in sample input from "sampleinput.bin" file
    if (!(ifp = fopen("sampleinput.bin", "rb"))) {
        printf("File sampleinput.bin cannot be opened for read.\n");
        return -1;
    }
    fseek(ifp, (offs*2), SEEK_SET);
    fread(sampleinput, 2, samplelength, ifp);
    fclose(ifp);

    // Read in sample out from "sampleout.bin" file
    if (!(ifp = fopen("sampleout.bin", "rb"))) {
        printf("File sampleout.bin cannot be opened for read.\n");
        return -1;
    }
    fseek(ifp, (offs*2*2), SEEK_SET);
    for (i = 0; i < samplelength; ++i)
        fread(sampleout[i], 2, 2, ifp);
    fclose(ifp);

    // Open "sampleresult.bin" file for sample result write back
    if (!(ofp = fopen("sampleresult.bin", "wb"))) {
        printf("File sampleresult.bin cannot be opened for write.\n");
        return -1;
    }

    // Open "weight.txt" file for weight record
    if (!(tfp = fopen("weight.txt", "w"))) {
        printf("File weight.txt cannot be opened for write\n");
        return -1;
    }

    short intWMS[NET_SIZE][SPARSE_BOUND] = {};
    unsigned short intWMS_j[NET_SIZE][SPARSE_BOUND] = {};

    for (i = 0; i < NET_SIZE; ++i) {
        t = 0;
        for (j = 0; j < NET_SIZE; ++j) {
            if (intWM[i][j] != 0) {
                intWMS[i][t] = intWM[i][j];
                intWMS_j[i][t] = j;
                t++;
            }
        }
    }


    for (i = 0; i < NET_SIZE+3; ++i)
        totalstate[i] = 0;

    //timersub(&tr, &tr, &tacc1);
    //timersub(&tr, &tr, &tacc2);
    gettimeofday(&t1, NULL);
    
    for (t = 0; t < (initialRunlength + plotRunlength); ++t) {
        if (t % 50000 == 0) {
            gettimeofday(&t2, NULL);
            timersub(&t1, &t2, &tr);
            //timeradd(&tacc2, &tr, &tacc2);

            //printf("Execute time 1: %.5f sec\n", -tacc1.tv_sec-(double)tacc1.tv_usec/1000000.0);
            printf("Execute time 2: %.5f sec\n", -tr.tv_sec-(double)tr.tv_usec/1000000.0);
            printf("Iteration %d: t = %d\n", (t/10000), t);

            //timersub(&tr, &tr, &tacc1);
            //timersub(&tr, &tr, &tacc2);
 
            gettimeofday(&t1, NULL);
        }

        in = sampleinput[t];
/*
        in = inputscaling * sampleinput[t] + inputshift;
        teach[0] = teacherscaling[0] * sampleout[t][0] + teachershift[0];
        teach[1] = teacherscaling[1] * sampleout[t][1] + teachershift[1];
*/
        totalstate[NET_SIZE] = in;
    
        //gettimeofday(&t2, NULL);
        //timersub(&t1, &t2, &tr);
        //timeradd(&tacc2, &tr, &tacc2);
        //gettimeofday(&t1, NULL);

        for (i = 0; i < NET_SIZE; ++i) {
            internalState[i] = 0;  
            for (j = 0; j < SPARSE_BOUND; ++j) {
                internalState[i] += intWMS[i][j] * totalstate[intWMS_j[i][j]];
            }
        }

        //gettimeofday(&t2, NULL);
        //timersub(&t1, &t2, &tr);
        //timeradd(&tacc1, &tr, &tacc1);
        //gettimeofday(&t1, NULL);
        
        for (i = 0; i < NET_SIZE; ++i) {
            internalState[i] += inWM[i] * totalstate[NET_SIZE];
            internalState[i] += ofbWM[0][i] * totalstate[NET_SIZE+1];
            internalState[i] += ofbWM[1][i] * totalstate[NET_SIZE+2];
            
            //if (internalState[i] > max_tanh_x)
            //    max_tanh_x = internalState[i];
            //else if (internalState[i] < min_tanh_x)
            //    min_tanh_x = internalState[i];
            
            //internalState[i] = tanhf(internalState[i]);
                        
            if (internalState[i] > 0) {
            	internalState_entry = (internalState[i] >> 20);
            	internalState[i] = lut[internalState_entry];
            }
            else {
            	internalState_entry = (-internalState[i] >> 20);
            	internalState[i] = -lut[internalState_entry];
            }            
            
            totalstate[i] = (internalState[i] << 1);
        }
        
        netOut[0] = 0;
        netOut[1] = 0;
        
        for (i = 0; i < NET_SIZE; ++i) {
            netOut[0] += outWM[i][0] * internalState[i];
            netOut[1] += outWM[i][1] * internalState[i];
        }
        netOut[0] += outWM[NET_SIZE][0] * in;
        //if (netOut[0] > max_tanh_x)
        //    max_tanh_x = netOut[0];
        //else if (netOut[0] < min_tanh_x)
        //    min_tanh_x = netOut[0];
        netOut[1] += outWM[NET_SIZE][1] * in;
        //if (netOut[1] > max_tanh_x)
        //    max_tanh_x = netOut[1];
        //else if (netOut[1] < min_tanh_x)
        //    min_tanh_x = netOut[1];
        
        //netOut[0] = tanhf(netOut[0]);
        //netOut[1] = tanhf(netOut[1]);
        
        if (netOut[0] > 0) {
        	netOut0_entry = (netOut[0] >> 20);
        	netOut[0] = lut[netOut0_entry];
        }
        else {
        	netOut0_entry = (-netOut[0] >> 20);
        	netOut[0] = -lut[netOut0_entry];
        }
        if (netOut[1] > 0) {
        	netOut1_entry = (netOut[1] >> 20);
        	netOut[1] = lut[netOut1_entry];
        }
        else {
        	netOut1_entry = (-netOut[1] >> 20);
        	netOut[1] = -lut[netOut1_entry];
        }        
        
        totalstate[NET_SIZE+1] = (netOut[0] << 1);
        totalstate[NET_SIZE+2] = (netOut[1] << 1);

//        fwrite(&in, 4, 1, ofp);
//        fwrite(netOut, 4, 2, ofp);
        
//        if (t <= initialRunlength) {
//            totalstate[NET_SIZE+1] = teach[0];
//            totalstate[NET_SIZE+2] = teach[1];
//        }
//        else {
//            totalstate[NET_SIZE+1] = netOut[0];
//            totalstate[NET_SIZE+2] = netOut[1];
//        }
    }

/*
    int ini;
    int tmp;
    int cnt[500];
    int id_reorder[500];
    int id_convert[500];
*/
    // Count non-zero weight values.
    /*for (t = 0; t < 500; ++t) {
        cnt[t] = 0;
        id_reorder[t] = t;
        for (j = 0; j < 500; ++j) {
            if (intWM[t][j] != 0) {
                cnt[t]++;
            }
        }
    }*/

    // Reorder non-zero weight values.
    /*for (t = 0; t < 500; ++t) {
        tmp = 500;
        i = t;
        for (j = t; j < 500; ++j) {
            if (cnt[j] < cnt[i])
                i = j;
        }
        tmp = cnt[t];
        cnt[t] = cnt[i];
        cnt[i] = tmp;
        tmp = id_reorder[t];
        id_reorder[t] = id_reorder[i];
        id_reorder[i] = tmp;
    }*/

    // Convert order exchange information.
    /*for (t = 0; t < 500; ++t) {
        id_convert[id_reorder[t]] = t;
    }*/

    // Store non-zero weight values in order.
    /*for (t = 0; t < 500; ++t) {
        fprintf(tfp, "{");
        ini = 0;
        for (j = 0; j < 500; ++j) {
            if (intWM[id_reorder[t]][j] != 0) {
                if (ini == 0) {
                    fprintf(tfp, "%f", intWM[id_reorder[t]][j]);
                    ini = 1;
                }
                else 
                    fprintf(tfp, ",%f", intWM[id_reorder[t]][j]);
            }
        }
        fprintf(tfp, "},\n");
    }*/

    // Store non-zero weight column index in order.
    /*for (t = 0; t < 500; ++t) {
        fprintf(tfp, "{");
        ini = 0;
        for (j = 0; j < 500; ++j) {
            if (intWM[id_reorder[t]][j] != 0) {
                if (ini == 0) {
                    fprintf(tfp, "%d", id_convert[j]);
                    ini = 1;
                }
                else 
                    fprintf(tfp, ",%d", id_convert[j]);
            }
        }
        fprintf(tfp, "},\n");
    }*/

    // Store order information of the row index exchange.
    /*for (t = 0; t < 10; ++t) {
        for (j = 0; j < 50; ++j) {
            fprintf(tfp, "%d,", id_reorder[t*50+j]);
        }
        fprintf(tfp, "\n");
    }*/

    // Store conversion information of the row index exchange.
    /*for (t = 0; t < 10; ++t) {
        for (j = 0; j < 50; ++j) {
            fprintf(tfp, "%d,", id_convert[t*50+j]);
        }
        fprintf(tfp, "\n");
    }*/

    // Store inWM vector according to exchanged order.
    /*for (t = 0; t < 50; ++t) {
        for (j = 0; j < 10; ++j) {
            fprintf(tfp, "%f,", inWM[id_reorder[t*10+j]]);
        }
        fprintf(tfp, "\n");
    }*/

    // Store ofbWM array according to exchanged order.
    /*for (t = 0; t < 2; ++t) {
        for (i = 0; i < 50; ++i) {
            for (j = 0; j < 10; ++j) {
                fprintf(tfp, "%f,", ofbWM[t][id_reorder[i*10+j]]);
            }
            fprintf(tfp, "\n");
        }
    }*/

    // Store outWM array according to exchanged order.
    /*for (t = 0; t < 100; ++t) {
        for (j = 0; j < 5; ++j) {
            fprintf(tfp, "%f,", outWM[id_reorder[t*5+j]][0]);
            fprintf(tfp, "%f,", outWM[id_reorder[t*5+j]][1]);
        }
        fprintf(tfp, "\n");
    }
    fprintf(tfp, "%f,%f\n", outWM[500][0], outWM[500][1]);*/

    //printf("Five Groups: %d, %d, %d, %d, %d\n", cnt[99], cnt[199], cnt[299], cnt[399], cnt[499]); 

    /*
    printf("%f\n", sampleout[0][0]);
    printf("%f\n", sampleout[1][0]);
    printf("%f\n", sampleout[2][0]);
    printf("%f\n", sampleout[0][1]);
    printf("%f\n", sampleout[1][1]);
    printf("%f\n", sampleout[2][1]);
    */

    fclose(ofp);
    fclose(tfp);

    //printf("Maximum tanh() value is: %f\n", max_tanh_x);
    //printf("Minimum tanh() value is: %f\n", min_tanh_x);

    printf("Processing complete.\n");

    return 0;
}
